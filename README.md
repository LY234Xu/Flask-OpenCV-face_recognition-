# 人脸识别系统项目

## 项目概述

本项目是一个基于Python的人脸识别系统，结合了摄像头图像采集、人脸检测、识别以及Web界面交互功能。系统能够实时识别已知人脸，当检测到未知人脸时，会提示用户保存新的人脸数据。主要使用了`picamera2`进行摄像头控制，`face_recognition`库进行人脸处理，`Flask`搭建Web服务。

## 功能特性

1. **实时人脸识别**：从摄像头捕获视频流，实时检测和识别已知人脸。
2. **未知人脸处理**：当检测到未知人脸一段时间后，弹出网页提示用户保存新的人脸数据。
3. **Web界面交互**：通过简单的Web界面，用户可以选择不同的识别模式，并在检测到未知人脸时进行保存操作。

## 环境要求

* **Python版本**：Python 3.9及以上
* **依赖库**：
  * `picamera2`：用于摄像头控制和图像采集
  * `opencv-python`：用于图像处理和显示
  * `face_recognition`：用于人脸检测和识别
  * `Flask`：用于搭建Web服务

你可以使用以下命令安装所需依赖：pip install picamera2 opencv-python face_recognition flask

## 项目结构face_recognition_project/

├── app.py # Flask应用主程序，处理Web请求├── face_recognition_english.py # 人脸识别主程序，包含人脸检测、识别等功能├── templates/│ ├── index.html # 起始页面，包含模式选择│ └── save_face.html # 保存人脸页面，让用户选择是否保存及输入姓名└── faces/ # 保存已知人脸图像的目录

## 使用方法

### 1. 启动Flask应用

在终端中运行以下命令启动Flask应用：python app.py启动成功后，在浏览器中访问 `http://127.0.0.1:5000`，即可看到起始页面。

### 2. 选择识别模式

在起始页面中，你可以选择以下两种模式：

* **模式1**：仅识别现有已知人脸数据。
* **模式2**：若检测到未知人脸，系统会提示你是否保存该人脸数据。

选择模式后，点击 `Start` 按钮开始人脸识别。

### 3. 处理未知人脸

若选择了模式2，当检测到未知人脸并持续一段时间（默认为3秒），系统会自动打开保存人脸的网页。在该页面中，你可以选择是否保存该人脸，并输入新的人脸名称。点击 `Submit` 按钮完成保存操作。

### 4. 退出程序

在摄像头显示窗口中，按下 `q` 键即可退出程序。

## 代码详解

### `face_recognition_english.py`

此文件包含了人脸识别的核心逻辑，以下是主要函数的说明：

* `load_reference_image(path)`：加载指定路径的图像，提取人脸编码。若图像加载失败或未检测到人脸，会抛出相应异常。
* `init_camera()`：初始化摄像头，设置分辨率、帧率、白平衡和曝光时间等参数。
* `save_new_face(frame, face_location, name)`：从当前帧中提取人脸区域，保存为JPEG图像，并更新已知人脸编码。
* `load_all_known_faces()`：从 `faces` 目录中加载所有已知人脸图像，提取编码并存储。
* `main()`：主程序入口，负责循环捕获摄像头帧，进行人脸检测、识别和处理未知人脸。

### `app.py`

该文件是Flask应用的主程序，处理Web请求：

* `/` 路由：显示起始页面。
* `/start` 路由：根据用户选择的模式启动人脸识别程序。
* `/save_face` 路由：处理保存人脸的请求，将新的人脸数据保存到本地，并更新已知人脸数据列表。

### `templates/index.html`

起始页面，包含模式选择和开始按钮，用户可以在此选择识别模式并启动程序。

### `templates/save_face.html`

保存人脸页面，让用户选择是否保存人脸以及输入人脸名称，提交后完成保存操作。

## 注意事项

* 确保摄像头设备正常工作，并且具备访问权限。
* 保存人脸数据时，确保输入的名称不包含特殊字符，以免出现文件保存错误。
* 若遇到问题，请检查依赖库是否安装正确，以及摄像头设备是否正常。

## 贡献与反馈

如果你对本项目有任何建议或发现了问题，欢迎提交Issue或Pull Request。我们将竭诚为你提供帮助。
